# Для сборки

версия node - 20 (20.12.1 текущая)
версия yarn - 4 (4.1.1 текущая)

По-умолчанию ставится yarn@1.22.19. Чтобы новый yarn запустился -

```docker
RUN corepack enable && corepack prepare yarn@${YARN_VERSION}
```

---

из корня проекта нужны:

- package.json
- yarn.lock
- папка `.yarn` - как кэш установленных зависимостей
- папка `packages` - код проекта

Внутри папки `packages` лежат два приложения. `client` - фронт часть на `react` и `server` - бек на `nestjs` (фреймворк поверх node).

---

yarn@4 по-умолчанию не создает папку `node_modules`, перед установкой зависимостей нужно добавить настройку в конфиг:

```docker
RUN yarn config set nodeLinker node-modules
```

по идее эта настройка сохранена в git - `.yarnrc.yml` - но у меня этот файл не копировался при билде образа

---

Устанавливаем зависимости

- `yarn` - все зависимости нужны чтобы прошла сборка typescript
- `yarn workspaces focus --all --production` - без дев зависимостей

---

после этого билдим фронт и бек пакеты скриптом `yarn build`
собранные приложения лежат в папках:

- фронт - `/packages/client/dist/`
- бек - `/packages/server/dist/`

---

## **для запуска бека и фронта нужно подтянуть переменные окружения**

---

запускаем бек в прод режиме `yarn server:start:prod`

бек стартует на порту 3004

---

для раздачи статики фронта нужен `nginx`

фронт стартует на порту 5678
